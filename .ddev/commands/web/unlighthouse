#!/bin/bash

## #ddev-generated
## Description: Run Unlighthouse scans with Swiss compliance
## Usage: unlighthouse [--demo-check|--mobile|--desktop]
## Example: "ddev unlighthouse --demo-check" or "ddev unlighthouse"

# Simple approach - run unlighthouse directly without complex docker setup

echo "🚀 ZH-DEMO Unlighthouse Scanner"
echo "==============================="

# Check if unlighthouse is installed
if ! command -v unlighthouse &> /dev/null; then
    echo "📦 Installing Unlighthouse..."
    npm install -g unlighthouse @unlighthouse/cli
fi

# Get site URL
SITE_URL="https://zh-demo.ddev.site"

# Parse arguments
case "$1" in
    --demo-check)
        echo "🎯 Running DEMO CHECK scan (3 samples, mobile + desktop)"
        echo "Perfect for pre-presentation validation!"
        unlighthouse --site "$SITE_URL" --samples 3 --port 5678 --host 0.0.0.0 &
        ;;
    --mobile)
        echo "📱 Running MOBILE scan (375px viewport)"
        unlighthouse --site "$SITE_URL" --device mobile --port 5678 --host 0.0.0.0 &
        ;;
    --desktop)
        echo "💻 Running DESKTOP scan (1200px viewport)"
        unlighthouse --site "$SITE_URL" --device desktop --port 5678 --host 0.0.0.0 &
        ;;
    --help)
        echo "🔍 ZH-DEMO Unlighthouse Commands:"
        echo ""
        echo "ddev unlighthouse              Full scan (mobile + desktop)"
        echo "ddev unlighthouse --demo-check Quick demo validation (3 samples)"
        echo "ddev unlighthouse --mobile     Mobile-only scan (375px)"
        echo "ddev unlighthouse --desktop    Desktop-only scan (1200px)"
        echo "ddev unlighthouse --help       This help message"
        echo ""
        echo "🌐 Results available at: https://zh-demo.ddev.site:5678"
        echo "📊 Swiss Compliance: WCAG 2.1 AA + eCH-0059"
        exit 0
        ;;
    *)
        echo "🔍 Running FULL scan (all pages, mobile + desktop)"
        echo "This may take 5-10 minutes..."
        unlighthouse --site "$SITE_URL" --port 5678 --host 0.0.0.0 &
        ;;
esac

echo ""
echo "✅ Unlighthouse started!"
echo "🌐 Open: https://zh-demo.ddev.site:5678"
echo "📊 Swiss Compliance Testing: WCAG 2.1 AA + eCH-0059"
echo ""
echo "💡 Tip: Use Ctrl+C to stop the scan"

# Keep the process running
wait