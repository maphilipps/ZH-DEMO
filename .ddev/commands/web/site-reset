#!/bin/bash

## Description: Reset site to clean installation state with default content
## Usage: site-reset
## Example: "ddev site-reset"

set -eu -o pipefail

echo "ğŸ”„ Resetting site to clean installation state..."

# Clear all caches
echo "ğŸ§¹ Clearing caches..."
drush cache:rebuild

# Import configuration
echo "âš™ï¸  Importing configuration..."
drush config:import --yes

# Import default content if available
if [ -d "$DDEV_DOCROOT/../content/default" ]; then
    echo "ğŸ“¦ Importing default content..."
    drush default-content:import --folder=$DDEV_DOCROOT/../content/default
else
    echo "âš ï¸  No default content found, skipping content import."
fi

# Run database updates
echo "ğŸ”„ Running database updates..."
drush updatedb --yes

# Clear final cache
echo "ğŸ§¹ Final cache clear..."
drush cache:rebuild

echo "âœ… Site reset completed!"
echo "ğŸ‰ Your site is now in clean installation state with default content."
echo "ğŸ’¡ Use 'ddev launch' to view your reset site."