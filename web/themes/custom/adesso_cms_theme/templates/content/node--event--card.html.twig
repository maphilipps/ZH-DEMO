{#
/**
 * @file
 * Theme override to display a node in card view mode.
 * Events Card with hero-style background image layout.
 */
#}

{# Get background image URL from field_featured_image #}
{% set bg_image_url = null %}
{% set has_featured_image = false %}

{% if node.field_featured_image is not empty and node.field_featured_image.entity %}
  {% set media = node.field_featured_image.entity %}
  {% set has_featured_image = true %}
  
  {# Check for field_media_image first #}
  {% if media.field_media_image is defined and media.field_media_image is not empty and media.field_media_image.entity %}
    {% set image_uri = media.field_media_image.entity.fileuri %}
    {% set bg_image_url = file_url(image_uri | image_style('16_9_1800x1080_focal_point_webp')) %}
  
  {# Fallback to field_image #}
  {% elseif media.field_image is defined and media.field_image is not empty and media.field_image.entity %}
    {% set image_uri = media.field_image.entity.fileuri %}
    {% set bg_image_url = file_url(image_uri | image_style('16_9_1800x1080_focal_point_webp')) %}
  {% endif %}
{% endif %}

{# Use fallback image if no image found #}
{% if not bg_image_url %}
  {% set bg_image_url = 'https://images.unsplash.com/photo-1496128858413-b36217c2ce36?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=3603&q=80' %}
{% endif %}

{# Background image as CSS background #}
<div class="absolute inset-0 -z-10 bg-cover bg-center bg-no-repeat" style="background-image: url('{{ bg_image_url }}');"></div>

{# Enhanced gradient overlay for better text readability #}
<div class="absolute inset-0 -z-10 bg-gradient-to-t from-gray-900 via-gray-900/40"></div>
<div class="absolute inset-0 -z-10 rounded-2xl ring-1 ring-inset ring-white/10"></div>

{# Event meta information #}
<div class="relative z-10 flex flex-wrap items-center gap-y-1 overflow-hidden text-sm/6 text-gray-300">
  {% if node.field_event__date.value %}
    <div class="mr-8">
      <time datetime="{{ node.field_event__date.value|date('c') }}">
        {{ node.field_event__date.value|date('d. F Y, H:i') }}
      </time>
      {% if node.field_event__date.end_value %}
        -
        <time datetime="{{ node.field_event__date.end_value|date('c') }}">
          {{ node.field_event__date.end_value|date('H:i') }}
        </time>
      {% endif %}
    </div>
  {% endif %}

  {# Event type indicator #}
  <div class="-ml-4 flex items-center gap-x-4">
    <svg viewBox="0 0 2 2" class="-ml-0.5 size-0.5 flex-none fill-white/50">
      <circle r="1" cx="1" cy="1" />
    </svg>
    <div class="flex gap-x-2.5">
      <svg class="size-6 flex-none rounded-full bg-white/10 p-1" viewBox="0 0 24 24" fill="currentColor">
        <path fill-rule="evenodd" d="M7.5 6a4.5 4.5 0 119 0 4.5 4.5 0 01-9 0zM3.751 20.105a8.25 8.25 0 0116.498 0 .75.75 0 01-.437.695A18.683 18.683 0 0112 22.5c-2.786 0-5.433-.608-7.812-1.7a.75.75 0 01-.437-.695z" clip-rule="evenodd" />
      </svg>
      Event
    </div>
  </div>
</div>

{# Event title and description #}
<h3 class="relative z-10 mt-3 text-lg/6 font-semibold text-white">
  <a href="{{ url }}" class="text-white hover:text-gray-200">
    <span class="absolute inset-0"></span>
    {{ label }}
  </a>
</h3>

{% if node.field_description.value %}
  <p class="relative z-10 mt-2 text-sm/6 text-gray-300 line-clamp-2">
    {{ node.field_description.value|striptags }}
  </p>
{% endif %}