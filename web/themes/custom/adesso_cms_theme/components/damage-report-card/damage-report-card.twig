{#
/**
 * @file
 * Damage Report Card component template for Infrastructure Damage Reports.
 *
 * @param {string} submission_id - Unique identifier for the submission (required)
 * @param {string} title - Brief title or damage type (required)
 * @param {string} description - Damage description or location
 * @param {string} status - Current workflow status (required) - neu|in_bearbeitung|erledigt|abgelehnt
 * @param {string} priority - Damage priority level - niedrig|mittel|hoch|notfall
 * @param {string} damage_type - Type of infrastructure damage
 * @param {string} location - Damage location or address
 * @param {string} created_date - Submission date (DD.MM.YYYY format)
 * @param {string} thumbnail_url - URL to damage photo thumbnail
 * @param {string} thumbnail_alt - Alt text for damage photo
 * @param {string} assigned_to - Municipal staff member assigned
 * @param {string} action_url - Link to detailed view or edit page
 * @param {string} modifier - Additional CSS classes
 */
#}
{% set card_id = submission_id|default('unknown') %}
{% set card_title = title|default('Schadensmeldung') %}
{% set card_description = description|default('') %}
{% set card_status = status|default('neu') %}
{% set card_priority = priority|default('mittel') %}
{% set card_damage_type = damage_type|default('') %}
{% set card_location = location|default('') %}
{% set card_date = created_date|default('') %}
{% set card_thumbnail = thumbnail_url|default('') %}
{% set card_thumbnail_alt = thumbnail_alt|default('Schadensfoto') %}
{% set card_assigned = assigned_to|default('') %}
{% set card_url = action_url|default('') %}
{% set card_modifier = modifier|default('') %}

{# Priority configuration #}
{% set priority_config = {
  'niedrig': {
    'label': 'Niedrig',
    'classes': 'bg-gray-100 text-gray-700 border border-gray-300',
    'icon': '<svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3"/></svg>'
  },
  'mittel': {
    'label': 'Mittel',
    'classes': 'bg-yellow-100 text-yellow-800 border border-yellow-300',
    'icon': '<svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>'
  },
  'hoch': {
    'label': 'Hoch',
    'classes': 'bg-orange-100 text-orange-800 border border-orange-300',
    'icon': '<svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18"/></svg>'
  },
  'notfall': {
    'label': 'Notfall',
    'classes': 'bg-red-100 text-red-800 border border-red-300 animate-pulse',
    'icon': '<svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"/></svg>'
  }
} %}

{% set current_priority = priority_config[card_priority]|default(priority_config.mittel) %}

{# Card container classes #}
{% set card_classes = [
  'damage-report-card',
  'bg-white border border-gray-200 rounded-lg shadow-sm hover:shadow-md transition-shadow duration-200',
  'p-4',
  card_modifier
]|join(' ')|trim %}

{# Clickable wrapper or div based on action_url #}
{% set wrapper_tag = card_url ? 'a' : 'div' %}

<{{ wrapper_tag }}{% if card_url %} href="{{ card_url }}"{% endif %} class="{{ card_classes }}"{% if card_url %} role="link" aria-label="Details zu {{ card_title }}"{% endif %}>
  
  <div class="flex items-start space-x-4">
    
    {# Thumbnail image #}
    {% if card_thumbnail %}
      <div class="flex-shrink-0">
        <img
          src="{{ card_thumbnail }}" 
          alt="{{ card_thumbnail_alt }}"
          class="w-16 h-16 object-cover rounded-lg border border-gray-200"
          loading="lazy"
        />
      </div>
    {% else %}
      {# Placeholder when no image available #}
      <div class="flex-shrink-0 w-16 h-16 bg-gray-100 rounded-lg border border-gray-200 flex items-center justify-center">
        <svg class="w-6 h-6 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
        </svg>
      </div>
    {% endif %}

    {# Main content area #}
    <div class="flex-1 min-w-0">
      
      {# Title and ID #}
      <div class="flex items-start justify-between mb-2">
        <div class="flex-1">
          <h3 class="text-base font-semibold text-gray-900 truncate">
            {{ card_title }}
          </h3>
          <p class="text-sm text-gray-500">
            ID: {{ card_id }}
            {% if card_date %}
              · {{ card_date }}
            {% endif %}
          </p>
        </div>
        
        {# Priority badge #}
        <div class="ml-2 flex-shrink-0">
          <span class="inline-flex items-center px-2 py-1 rounded-md text-xs font-medium {{ current_priority.classes }}">
            {{ current_priority.icon }}
            <span class="ml-1">{{ current_priority.label }}</span>
          </span>
        </div>
      </div>

      {# Description #}
      {% if card_description %}
        <p class="text-sm text-gray-600 mb-3 line-clamp-2">
          {{ card_description }}
        </p>
      {% endif %}

      {# Metadata row #}
      <div class="flex items-center justify-between text-xs text-gray-500">
        <div class="flex items-center space-x-4">
          
          {# Location #}
          {% if card_location %}
            <div class="flex items-center">
              <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
              </svg>
              <span class="truncate">{{ card_location }}</span>
            </div>
          {% endif %}

          {# Damage type #}
          {% if card_damage_type %}
            <div class="flex items-center">
              <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"/>
              </svg>
              <span>{{ card_damage_type }}</span>
            </div>
          {% endif %}
        </div>

        {# Assignment #}
        {% if card_assigned %}
          <div class="flex items-center">
            <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
            </svg>
            <span>{{ card_assigned }}</span>
          </div>
        {% endif %}
      </div>
    </div>

    {# Status badge #}
    <div class="flex-shrink-0">
      {% include 'sdc:status-badge' with {
        status: card_status,
        size: 'sm'
      } %}
    </div>
  </div>

  {# Action buttons for municipal staff #}
  {% if not card_url %}
    <div class="mt-4 pt-3 border-t border-gray-100 flex items-center justify-between">
      <div class="flex space-x-2">
        <button type="button" class="text-xs text-blue-600 hover:text-blue-800 font-medium">
          Details anzeigen
        </button>
        {% if card_status != 'erledigt' and card_status != 'abgelehnt' %}
          <button type="button" class="text-xs text-green-600 hover:text-green-800 font-medium">
            Status ändern
          </button>
        {% endif %}
      </div>
      
      {% if card_status == 'neu' %}
        <button type="button" class="text-xs bg-blue-50 text-blue-700 px-2 py-1 rounded hover:bg-blue-100">
          Zuweisen
        </button>
      {% endif %}
    </div>
  {% endif %}

</{{ wrapper_tag }}>