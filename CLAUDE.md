# Adesso CMS - Drupal Project

This is a modern Drupal CMS project featuring Single Directory Components (SDC), Tailwind CSS v4, Storybook integration, and comprehensive theming architecture.

## AI Team Configuration (autogenerated by team-configurator, 2025-08-08)

**Important: YOU MUST USE subagents when available for the task.**

### Detected Stack
- **CMS**: Drupal 11.2.2 with Drupal CMS recipes and AI modules
- **Theme**: Custom Drupal theme with SDC architecture
- **Frontend**: Tailwind CSS v4, Vite, Alpine.js, Flowbite components
- **Testing**: Vitest, BackstopJS (visual regression), Playwright
- **Build**: Vite, PostCSS, ESLint, Stylelint
- **Components**: Storybook 8.6.7 for component development
- **Content**: Paragraphs module with extensive paragraph types (hero, card-group, carousel, etc.)

### Task Assignments

| Task | Agent | Notes |
|------|-------|--------|
| **QA & Testing** |  |  |
| Visual Regression Testing | `qa-testing-specialist` | **MUST USE** browser-tools MCP for screenshots and visual testing |
| Automated Testing Setup | `qa-testing-specialist` | Configure Vitest, Playwright, and BackstopJS with proper MCP integration |
| Accessibility Testing | `qa-testing-specialist` | **MUST USE** a11y-accessibility MCP for WCAG compliance testing |
| Performance Testing | `performance-optimizer` | **MUST USE** browser-tools MCP for Core Web Vitals and performance audits |
| **Development & Code Quality** |  |  |
| Code Review & Quality | `code-reviewer` | Always include for PR reviews and code quality |
| Drupal Backend Development | `drupal-senior-backend-dev` | Custom modules, hooks, and Drupal-specific backend logic |
| SDC Component Development | `storybook-sdc-maintainer` | Primary for component library architecture and Storybook integration |
| Theme Development | `drupal-frontend-theming-specialist` | Drupal theming with Twig, preprocessing, and render arrays |
| Interactive Components | `alpine-js-frontend-developer` | Alpine.js behaviors, client-side interactions, and Flowbite integration |
| Styling & Responsive Design | `tailwind-css-expert` | Tailwind CSS v4, responsive design, and utility-first CSS |
| Migration & Update Paths | `drupal-migrate-specialist` | Migrate API, idempotent Updates, Rollbacks |
| SEO & Structured Data | `seo-structured-data-specialist` | Schema.org, Meta, Sitemaps, redirects |
| Analytics & Consent | `analytics-tracking-specialist` | GTM/Consent Mode v2, Events, privacy by default |
| Media & Image Optimization | `media-image-optimization-specialist` | Responsive Images, WebP/AVIF, lazy loading |
| SDC Hybrid Migration | `sdc-hybrid-migration-specialist` | Propsâ†’Slots Hybrid, Codemod, Stories/Backstop/A11y |
| Migration & Update Paths | `drupal-migrate-specialist` | Migrate API, idempotent Updates, Rollbacks |
| SEO & Structured Data | `seo-structured-data-specialist` | Schema.org, Meta, Sitemaps, redirects |
| Analytics & Consent | `analytics-tracking-specialist` | GTM/Consent Mode v2, Events, privacy by default |
| Media & Image Optimization | `media-image-optimization-specialist` | Responsive Images, WebP/AVIF, lazy loading |
| **Architecture & Planning** |  |  |
| Component Architecture | `frontend-designer` | SDC design patterns and component system planning |
| Content Strategy | `content-writer` | Drupal content types, paragraphs, and editorial workflows |
| API & Backend Logic | `backend-developer` | General backend tasks and API development |
| Security Auditing | `security-auditor` | **MUST USE** browser-tools for security audits, OWASP compliance |
| Project Planning | `project-task-planner` | Breaking down features and sprint planning |
| Codebase Analysis | `code-archaeologist` | Understanding existing structure and dependencies |
| Documentation | `documentation-specialist` | **MUST USE** context7 MCP for accessing library docs |
| Search Architecture | `drupal-search-architect` | Search API, Solr/OpenSearch, facets, synonyms |
| Caching & CDN Strategy | `caching-and-cdn-architect` | Varnish/CDN headers, cache contexts/tags |
| API Strategy | `api-integration-architect` | JSON:API/REST/GraphQL, contracts, rate limits |
| Workflow & Moderation | `workflow-moderation-specialist` | Content Moderation, roles/permissions |
| Privacy & Compliance | `privacy-compliance-officer` | DSGVO/consent, data retention |
| Internationalization Strategy | `i18n-localization-specialist` | Locale/TMGMT, translation workflows |
| DevOps & Observability | `drupal-devops-observability` | CI/CD hardening, monitoring, logs/alerts |
| Search Architecture | `drupal-search-architect` | Search API, Solr/OpenSearch, facets, synonyms |
| Caching & CDN Strategy | `caching-and-cdn-architect` | Varnish/CDN headers, cache contexts/tags |
| API Strategy | `api-integration-architect` | JSON:API/REST/GraphQL, contracts, rate limits |
| Workflow & Moderation | `workflow-moderation-specialist` | Content Moderation, roles/permissions |
| Privacy & Compliance | `privacy-compliance-officer` | DSGVO/consent, data retention |
| Internationalization Strategy | `i18n-localization-specialist` | Locale/TMGMT, translation workflows |
| DevOps & Observability | `drupal-devops-observability` | CI/CD hardening, monitoring, logs/alerts |

### MCP Integration Requirements

**All agents MUST leverage available MCPs when applicable:**

#### Browser Tools MCP (`browser-tools`)
- **Required for**: Visual regression testing, performance audits, accessibility testing, security scans
- **Use cases**: Screenshots for visual tests, Lighthouse audits, console log analysis
- **Primary agents**: `qa-testing-specialist`, `performance-optimizer`, `security-auditor`

#### Playwright MCP (`playwright`)
- **Required for**: End-to-end testing, browser automation, interaction testing
- **Use cases**: E2E test automation, form testing, navigation testing
- **Primary agents**: `qa-testing-specialist`, `alpine-js-frontend-developer`

#### A11y Accessibility MCP (`a11y-accessibility`)
- **Required for**: WCAG compliance testing, accessibility audits
- **Use cases**: Screen reader testing, keyboard navigation, color contrast validation
- **Primary agents**: `qa-testing-specialist`, `drupal-frontend-theming-specialist`

#### Fetch MCP (`fetch`)
- **Required for**: API testing, external content retrieval, integration testing
- **Use cases**: API endpoint testing, external service validation
- **Primary agents**: `backend-developer`, `qa-testing-specialist`

#### Context7 MCP (`context7`)
- **Required for**: Library documentation access, API reference lookup
- **Use cases**: Drupal API docs, Tailwind docs, component library references
- **Primary agents**: `documentation-specialist`, `drupal-senior-backend-dev`

### Enhanced QA Workflows

#### Pre-Commit QA Workflow
1. **Code Quality**: `code-reviewer` validates coding standards
2. **Unit Testing**: `qa-testing-specialist` runs Vitest test suite
3. **Visual Testing**: `qa-testing-specialist` uses browser-tools MCP for visual regression
4. **Accessibility**: `qa-testing-specialist` uses a11y-accessibility MCP for compliance
5. **Performance**: `performance-optimizer` uses browser-tools MCP for Core Web Vitals

#### Component Development QA Workflow
1. **Design**: `frontend-designer` creates component specification
2. **Implementation**: `storybook-sdc-maintainer` builds SDC component
3. **Styling**: `tailwind-css-expert` implements responsive design
4. **Interactions**: `alpine-js-frontend-developer` adds Alpine.js behaviors
5. **Testing**: `qa-testing-specialist` creates comprehensive test coverage:
   - Unit tests with Vitest
   - Visual regression with BackstopJS + browser-tools MCP
   - Accessibility testing with a11y-accessibility MCP
   - E2E testing with Playwright MCP
6. **Performance**: `performance-optimizer` validates performance impact
7. **Review**: `code-reviewer` conducts final code review

#### Deployment QA Workflow
1. **Security Audit**: `security-auditor` uses browser-tools MCP for security scans
2. **Performance Baseline**: `performance-optimizer` establishes performance benchmarks
3. **Accessibility Compliance**: `qa-testing-specialist` validates WCAG 2.1 AA compliance
4. **Cross-Browser Testing**: `qa-testing-specialist` uses Playwright MCP for multi-browser validation
5. **Load Testing**: `qa-testing-specialist` conducts stress testing
6. **Documentation**: `documentation-specialist` updates deployment and testing docs

### Project-Specific Guidelines

#### For Theme Development:
- **Primary Agent**: `drupal-frontend-theming-specialist` for Drupal-specific theming
- **Component Creation**: `storybook-sdc-maintainer` for SDC architecture, then `tailwind-css-expert` for styling
- **Interactive Features**: `alpine-js-frontend-developer` for client-side behaviors
- **Testing**: `qa-testing-specialist` with **mandatory** browser-tools MCP integration
- **Code Quality**: Always `code-reviewer` before committing changes

#### For Drupal Backend:
- **Custom Modules**: Use `drupal-senior-backend-dev` for Drupal-specific PHP logic
- **Content Architecture**: Use `content-writer` for content types and paragraph planning
- **API Integration**: Use `backend-developer` for Views, custom endpoints, and data structures
- **Testing**: `qa-testing-specialist` must use fetch MCP for API testing

#### For Component System:
- **SDC Components**: Primary `storybook-sdc-maintainer`, secondary `tailwind-css-expert`
- **Storybook Stories**: Use `storybook-sdc-maintainer` for comprehensive documentation
- **Visual Testing**: `qa-testing-specialist` **must** use browser-tools MCP for visual regression
- **Performance Testing**: `performance-optimizer` **must** use browser-tools MCP for audits

### Special Considerations

1. **Drupal CMS Recipes**: This project uses Drupal CMS with AI-enabled modules - ensure compatibility when making changes
2. **SDC Architecture**: All components follow Single Directory Component patterns with Twig templates, CSS, JS, and YAML config
3. **Theme Selector**: Project includes dark/light theme switching - maintain theme compatibility across all variants
4. **Performance Critical**: Theme includes extensive visual regression testing and performance monitoring - **all performance work must use browser-tools MCP**
5. **Accessibility**: WCAG 2.1 AA compliance required for all components - **mandatory a11y-accessibility MCP usage**
6. **Cross-Browser Support**: All features must work across modern browsers - **mandatory Playwright MCP testing**

### Enhanced Development Workflow

1. **Planning**: `project-task-planner` breaks down features with QA requirements
2. **Architecture**: `storybook-sdc-maintainer` designs component architecture
3. **Implementation**: Parallel development by specialized agents
4. **Interactive Features**: `alpine-js-frontend-developer` adds client-side behaviors
5. **Comprehensive QA**: `qa-testing-specialist` conducts multi-layered testing with MCP integration:
   - Unit tests (Vitest)
   - Visual regression (BackstopJS + browser-tools MCP)
   - Accessibility testing (a11y-accessibility MCP)
   - E2E testing (Playwright MCP)
   - Performance audits (browser-tools MCP)
6. **Performance Validation**: `performance-optimizer` ensures optimal performance
7. **Security Review**: `security-auditor` validates security with browser-tools MCP
8. **Code Review**: `code-reviewer` conducts final code review
9. **Documentation**: `documentation-specialist` updates docs using context7 MCP

### Quality Gates

**No code may be merged without:**
- Passing unit tests (Vitest)
- Visual regression tests (BackstopJS + browser-tools MCP)
- Accessibility compliance (a11y-accessibility MCP)
- Performance benchmarks (browser-tools MCP)
- Security validation (browser-tools MCP)
- Code review approval (`code-reviewer`)

---

*Generated by team-configurator on 2025-08-08*

### Development Workflow (MANDATORY)

#### Task Management Integration
- **ALL** development work MUST be managed through `.claude/TASKS.md`
- **BEFORE** starting any new task: Check and process open PRs
- Tasks MUST follow status progression: `pending` â†’ `in_progress` â†’ `completed`

#### Branch-Based Development (MANDATORY)
- **NEVER** work directly on `main` branch
- **ALL** work MUST be done in feature branches: `feature/[task-description]`
- **ALL** branches MUST be assigned to GitHub Copilot for review
- **ALL** PRs MUST have Copilot approval before merge

#### Mandatory Commands for New Tasks
```bash
# 1. Check open PRs (MANDATORY before starting new task)
gh pr list --state open
gh pr status

# 2. Create feature branch
git checkout -b feature/[task-name]

# 3. Push and create PR with Copilot review
git push -u origin feature/[task-name]
gh pr create --title "[Task Name]" --body "Description" --reviewer @copilot
```

#### Reflexion Cycles (MANDATORY)
- **EVERY 30 MINUTES**: Ask "Reflect on what you've built so far. Are there edge cases we missed? Should we try a different approach? Continue."
- **AFTER EVERY TASK COMPLETION**: Execute auto-prompt from `.claude/TASKS.md`

#### Auto-Prompt After Task Completion
```
Please pull the next task from TASKS.md and fully implement and test it.
After running tests, analyze logs and screenshots to verify correctness.
If you spot any failures or issues, fix them and rerun testsâ€”keep iterating until everything passes.
Once verified, commit your changes, then fetch the next task from TASKS.md.
```

### Quality Gates (MANDATORY)

**Pre-Commit Requirements:**
- [ ] All tests pass (Unit, Functional, Performance)
- [ ] PHPStan Level 8 compliance
- [ ] PHPCS Drupal Standards compliance
- [ ] Performance baselines maintained
- [ ] Task status updated in TASKS.md

**Pre-PR Requirements:**
- [ ] Feature branch created from main
- [ ] GitHub Copilot assigned as reviewer
- [ ] All quality gates passed
- [ ] Documentation updated

**Pre-Merge Requirements:**
- [ ] Copilot review completed
- [ ] All CI/CD checks passing
- [ ] No merge conflicts
- [ ] Task marked as `completed` in TASKS.md

### Definition of Done

- Implementation matches specs from lead agents and passes all Quality Gates above
- Documentation updated (component/README, recipes notes, or module docs)
- Visual baselines updated intentionally when UI changes are expected
- `CLAUDE.md` team section current if stack or responsibilities changed
- **Task documented as `completed` in `.claude/TASKS.md`**
- **Branch merged via PR with Copilot approval**

### Do / Don't

**DO:**
- Use specialized subagents (`drupal-senior-backend-dev`, `storybook-sdc-maintainer`, etc.) for focused work
- Run MCP-powered checks (browser-tools, a11y, playwright) where noted
- Keep diffs minimal and reversible; snapshot with DDEV before risky ops
- **Always work in feature branches with Copilot review**
- **Update TASKS.md with every status change**
- **Process open PRs before starting new tasks**

**DON'T:**
- Bypass planning by OPUS agents for non-trivial tasks
- Merge without visual/accessibility/performance validation where applicable
- **NEVER push directly to main branch**
- **NEVER start new tasks without processing open PRs**
- **NEVER commit failing tests**

## SDC Hybrid Migration Progress

### Completed Migrations

#### Slider Component (Issue #91) - COMPLETED âœ…
**Date**: 2025-08-08  
**Branch**: `feature/hybrid-slider`  

**Migration Details**:
- **Dual Component Structure**: Successfully migrated both `slider.component.yml` and `slider-item.component.yml` to hybrid pattern
- **Slots Configuration**: 
  - **Slider**: `items`, `heading`, `navigation` slots
  - **Slider-Item**: `media`, `content`, `overlay`, `actions` slots
- **Swiper.js Integration**: Enhanced JavaScript behavior to support new configuration options (effect, loop, slides_per_view, space_between)
- **Template Architecture**:
  - Created `slider.slots.twig` and `slider-item.slots.twig` for pure slot-based usage
  - Updated main templates with hybrid pattern (slots with props fallback)
  - Updated paragraph templates to use embed pattern for enhanced flexibility

**Interactive Features Preserved**:
- Touch/swipe gestures and responsive breakpoints
- Multiple effects: slide, fade, cube, flip transitions
- Autoplay functionality with pause on hover/interaction
- Navigation controls: arrows, pagination dots
- Loop/infinite scrolling capability
- ARIA attributes and keyboard navigation

**Usage Patterns**:
```twig
{# Modern (slots-first) #}
{% embed 'sdc:slider' with { autoplay: true, effect: 'fade' } %}
  {% block items %}
    {% embed 'sdc:slider-item' %}
      {% block media %}<img src="..." alt="..." />{% endblock %}
      {% block content %}<h3>Title</h3><p>Content</p>{% endblock %}
    {% endembed %}
  {% endblock %}
{% endembed %}

{# Legacy (backward compatible) #}
{% include 'sdc:slider' with {
  items: content.field_slider_items,
  autoplay: true,
  effect: 'slide'
} %}
```

**Quality Assurance**:
- âœ… **Accessibility**: WCAG 2.1 AA compliant (tested with a11y-accessibility MCP)
- âœ… **JavaScript**: Enhanced Swiper.js behavior validated for syntax and functionality
- âœ… **Backward Compatibility**: Legacy props-based usage fully preserved
- âœ… **Storybook Stories**: Comprehensive examples including hybrid patterns and composition examples

**Files Modified**:
- `components/slider/slider.component.yml` - Added slots configuration
- `components/slider/slider-item.component.yml` - Added slots configuration  
- `components/slider/slider.twig` - Hybrid pattern (slots with props fallback)
- `components/slider/slider-item.twig` - Hybrid pattern (slots with props fallback)
- `components/slider/slider.slots.twig` - Pure slot-based template
- `components/slider/slider-item.slots.twig` - Pure slot-based template
- `components/slider/slider.behavior.js` - Enhanced configuration support
- `components/slider/slider.stories.js` - Added hybrid pattern examples
- `components/slider/templates/paragraph--slider.html.twig` - Embed pattern usage
- `components/slider/templates/paragraph--slider-item.html.twig` - Enhanced composition

**Key Learnings**:
- Dual component structure requires coordinated migration of both container and item components
- Swiper.js configuration needs to be enhanced to support new data attributes from hybrid templates
- Interactive components benefit greatly from slot-based media and overlay composition
- Embed pattern in paragraph templates provides enhanced flexibility without breaking existing functionality

EOF < /dev/null
