name: 'CI Pipeline Debug'

on:
  pull_request:
    branches: [ main ]

env:
  BRAND_VALIDATION: 'adesso'

jobs:
  debug-analysis:
    name: 'Debug Analysis'
    runs-on: ubuntu-24.04
    timeout-minutes: 5
    steps:
      - name: 'ğŸ“¥ Checkout code'
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: 'ğŸ·ï¸ Test German brand compliance'
        run: |
          echo "âœ… Testing German brand compliance validation..."
          
          # Check for improper brand usage in content (allow legitimate project names)
          VIOLATIONS=$(grep -r "ADESSO" --include="*.php" --include="*.twig" web/ 2>/dev/null | \
            grep -v "adesso CMS" | \
            grep -v "adesso-cms" | \
            grep -v "# adesso" || true)
          
          if [ -n "$VIOLATIONS" ]; then
            echo "âŒ Brand violation: 'adesso wird immer klein geschrieben'"
            echo "Found improper uppercase instances:"
            echo "$VIOLATIONS"
            exit 1
          else
            echo "âœ… German brand compliance validated: adesso brand usage is correct"
            echo "Note: Project names 'adesso CMS' and documentation titles are allowed"
          fi

      - name: 'ğŸ“ Check project structure'
        run: |
          echo "ğŸ“ Project structure check:"
          ls -la
          echo ""
          echo "ğŸ“ Web directory:"
          ls -la web/ || echo "Web directory not found"
          echo ""
          echo "ğŸ“ GitHub workflows:"
          ls -la .github/workflows/

      - name: 'âœ… Debug complete'
        run: |
          echo "âœ… Debug analysis completed successfully"
          echo "All validation steps passed"