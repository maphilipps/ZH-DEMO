#!/bin/bash

## Description: Export only changed Drupal configuration (diffs only)
## Usage: config-export
## Example: "ddev config-export"

set -eu -o pipefail

echo "ğŸ“¤ Exporting changed Drupal configuration (diffs only)..."

# Check if there are configuration changes
CHANGES=$(drush config:status --format=json | jq -r 'length')

if [ "$CHANGES" -eq 0 ]; then
    echo "âœ… No configuration changes detected."
    echo "ğŸ’¡ All configuration is already in sync."
    exit 0
fi

echo "ğŸ” Found $CHANGES configuration changes:"
drush config:status

# Export only the changed configurations
echo "ğŸ“¤ Exporting changed configurations..."
drush config:export --diff --yes

# Show what was changed
echo "âœ… Configuration changes exported to config/sync/"
echo "ğŸ“Š Changed configurations:"
drush config:status --format=table

echo "ğŸ’¡ Only changed configurations were exported!"
echo "ğŸ’¡ Remember to commit configuration changes to git!"