{#
/**
 * @file
 * Carousel component - cards layout
 *
 * Available variables:
 * - items: Array of carousel items to display
 * - cards_per_view: Number of cards visible at once
 * - autoplay: Enable autoplay functionality
 * - interval: Time between slides in milliseconds
 * - pause_on_hover: Pause autoplay on hover
 * - class: Additional CSS classes for the container
 */
#}

{# Set up defensive variables with defaults #}
{% set safe_items = items|default([]) %}
{% set safe_autoplay = autoplay|default(false) %}
{% set safe_interval = interval|default(5000) %}
{% set safe_pause_on_hover = pause_on_hover|default(true) %}
{% set safe_cards_per_view = cards_per_view|default(3) %}
{% set carousel_id = 'carousel-' ~ random() %}

{% set carousel_classes = [
  'adesso-carousel',
  'swiper',
  'relative',
  'w-full',
  class|default(''),
] %}

{% set carousel_attributes = [
  'data-swiper-carousel="true"',
  'data-swiper-id="%s"'|format(carousel_id),
  'data-swiper-autoplay="%s"'|format(safe_autoplay ? 'true' : 'false'),
  'data-swiper-interval="%d"'|format(safe_interval),
  'data-swiper-pause-on-hover="%s"'|format(safe_pause_on_hover ? 'true' : 'false'),
  'data-swiper-cards-per-view="%d"'|format(safe_cards_per_view),
  'role="region"',
  'aria-label="Interactive carousel"',
  'aria-roledescription="carousel"',
] %}

{# Only render if we have items #}
{% if safe_items and safe_items|length > 0 %}
<!-- Carousel wrapper with navigation - Full bleed container -->
<div class="relative w-full">
    <!-- Header section with navigation -->
    <div class="carousel-header container mx-auto px-4 2xl:px-0 mb-6 flex flex-col sm:flex-row justify-between items-start sm:items-end gap-6">
        <div class="flex-1"></div> <!-- Spacer for navigation alignment -->
        
        <!-- Navigation buttons -->
        <div class="flex gap-2">
            <button class="swiper-prev-{{ carousel_id }} carousel-nav-button carousel-nav-prev" aria-label="Previous slide">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round" class="rotate-180">
                    <path d="m9 18 6-6-6-6"></path>
                </svg>
            </button>
            <button class="swiper-next-{{ carousel_id }} carousel-nav-button carousel-nav-next" aria-label="Next slide">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="m9 18 6-6-6-6"></path>
                </svg>
            </button>
        </div>
    </div>
    
    <!-- Swiper container - Full width with left padding -->
    <div class="{{ carousel_classes|join(' ')|trim }} pl-4 2xl:pl-0" {{ carousel_attributes|join(' ')|raw }}>
        
        <div class="swiper-wrapper">
                {% block carousel_items %}
                    {% for item in safe_items %}
                        <div class="swiper-slide carousel-slide" 
                             role="group" 
                             aria-roledescription="slide"
                             aria-label="Slide {{ loop.index }} of {{ safe_items|length }}"
                             data-slide-index="{{ loop.index0 }}">
                            {% include 'adesso_cms_theme:carousel-item' with {
                              item: item,
                              item_class: item_class|default('')
                            } only %}
                        </div>
                    {% endfor %}
                {% endblock %}
        </div>
    </div>
</div>
{% else %}
  {# Fallback for empty carousel #}
  <div class="carousel-empty p-8 text-center text-gray-500 bg-gray-50 rounded-lg">
    <p>No carousel items available</p>
  </div>
{% endif %}