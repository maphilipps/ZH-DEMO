{#
/**
 * @file
 * Theme override for search form block with el-popover.
 */
#}
{%- set attributes = attributes.addClass('search-block-wrapper relative inline-block z-50') -%}

<div{{ attributes }}>
  {# Search trigger button with magnifying glass icon #}
  <button 
    popovertarget="search-popover"
    type="button"
    class="search-trigger inline-flex items-center p-2 text-gray-500 hover:text-gray-900 dark:text-gray-400 dark:hover:text-white focus:outline-none focus:ring-2 focus:ring-primary rounded-lg transition-colors"
    aria-label="{{ 'Open search'|t }}"
  >
    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
    </svg>
    <span class="sr-only">{{ 'Toggle search'|t }}</span>
  </button>

  {# Search Popover using el-popover #}
  <el-popover 
    id="search-popover" 
    anchor="bottom-end" 
    popover
    class="w-96 overflow-visible bg-transparent transition transition-discrete [--anchor-gap:--spacing(2)] backdrop:bg-transparent open:flex data-closed:translate-y-1 data-closed:opacity-0 data-enter:duration-200 data-enter:ease-out data-leave:duration-150 data-leave:ease-in"
  >
    <div class="w-full rounded-lg bg-white shadow-lg ring-1 ring-gray-900/5 dark:bg-gray-800 dark:ring-gray-700">
      {# Header #}
      <div class="px-4 py-3 bg-gray-50 border-b border-gray-200 rounded-t-lg dark:bg-gray-700 dark:border-gray-600">
        <div class="flex items-center justify-between">
          <h3 class="text-sm font-semibold text-gray-900 dark:text-white">
            {{ 'Search'|t }}
          </h3>
          <button
            type="button"
            popovertarget="search-popover"
            popovertargetaction="hide"
            class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 focus:outline-none focus:ring-2 focus:ring-primary rounded-lg p-1 transition-colors"
            aria-label="{{ 'Close search'|t }}"
          >
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
            </svg>
          </button>
        </div>
      </div>
      
      {# Search form content #}
      <div class="p-4">
        <div class="search-form-content">
          {{ content }}
        </div>
        
        {# Quick search suggestions #}
        <div class="mt-4 pt-4 border-t border-gray-200 dark:border-gray-600">
          <p class="text-xs text-gray-500 dark:text-gray-400 mb-3 font-medium">{{ 'Popular searches:'|t }}</p>
          <div class="flex flex-wrap gap-2">
            <a href="/search?keys=aktuelles" class="px-3 py-1.5 text-xs bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-md transition-colors dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600">
              {{ 'Aktuelles'|t }}
            </a>
            <a href="/search?keys=veranstaltungen" class="px-3 py-1.5 text-xs bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-md transition-colors dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600">
              {{ 'Veranstaltungen'|t }}
            </a>
            <a href="/search?keys=dienstleistungen" class="px-3 py-1.5 text-xs bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-md transition-colors dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600">
              {{ 'Dienstleistungen'|t }}
            </a>
            <a href="/search?keys=kontakt" class="px-3 py-1.5 text-xs bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-md transition-colors dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600">
              {{ 'Kontakt'|t }}
            </a>
          </div>
        </div>
      </div>
    </div>
  </el-popover>
</div>

{# Auto-focus search input when popover opens #}
<script>
  document.addEventListener('DOMContentLoaded', function() {
    const searchPopover = document.getElementById('search-popover');
    
    if (searchPopover) {
      // Listen for popover toggle event
      searchPopover.addEventListener('toggle', function(event) {
        if (event.newState === 'open') {
          // Focus search input when popover opens
          setTimeout(function() {
            const searchInput = searchPopover.querySelector('input[type="search"], input[type="text"]');
            if (searchInput) {
              searchInput.focus();
            }
          }, 50);
        }
      });
    }
  });
</script>